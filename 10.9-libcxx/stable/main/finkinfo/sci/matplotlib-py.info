# -*- coding: ascii; tab-width: 4 -*-; tab-width: 4; x-counterpart: matplotlib-py.patch -*-
Info2: <<

Package: matplotlib-py%type_pkg[python]
Version: 3.3.2
Revision: 1
Source: https://files.pythonhosted.org/packages/source/m/matplotlib/matplotlib-%v.tar.gz
Source-Checksum: SHA256(3d2edbf59367f03cd9daf42939ca06383a7d7803e3993eb5ff1bee8e8a3fbb6b)
Source2: http://download.savannah.gnu.org/releases/freetype/freetype-2.6.1.tar.gz
Source2-MD5: 348e667d728c597360e4a87c16556597

Type: python (3.6 3.7 3.8)

Maintainer: Derek Homeier <dhomeie@gwdg.de>
Depends: <<
 atk1-shlibs (>= 1.32.0-1),
 cairo-shlibs (>= 1.12.14-1),
 cycler-py%type_pkg[python] (>= 0.10.0-1),
 dateutil-py%type_pkg[python] (>= 2.7.3-1),
 fontconfig2-shlibs (>= 2.10.0-1),
 glib2-shlibs (>= 2.22.0-1),
 gtk+2-shlibs (>= 2.18.0-1),
 kiwisolver-py%type_pkg[python] (>= 1.2.0-1),
 libpng16-shlibs,
 pango1-xft2-ft219-shlibs (>= 1.24.5-4),
 pil-py%type_pkg[python] (>= 6.2.0-1),
 poppler-bin,
 python%type_pkg[python],
 pyparsing-py%type_pkg[python],
 pyqt4-mac-py%type_pkg[python],
 pyqt5-mac-py%type_pkg[python] (>= 5.11.3-1),
 pytz-py%type_pkg[python],
 numpy-py%type_pkg[python],
 sip-pyqt4-py%type_pkg[python] (>= 4.19.22-1),
 sip-pyqt5-py%type_pkg[python] (>= 4.19.22-1),
 six-py%type_pkg[python] (>= 1.4.0-1),
 tcltk-shlibs,
 tetex-base,
 tornado-py%type_pkg[python],
 wxpython400-py%type_pkg[python] | wxpython410-py%type_pkg[python],
 x11-shlibs
<<

BuildDepends: <<
 atk1 (>= 1.32.0-1),
 cairo (>= 1.12.14-1),
 certifi-py%type_pkg[python] (>= 2020.6.20-1),
 fink (>= 0.32.0-1),
 fink-package-precedence,
 fontconfig2-dev (>= 2.10.0-1),
 glib2-dev (>= 2.22.0-1),
 gtk+2-dev (>= 2.18.0-1),
 libpng16,
 pango1-xft2-ft219-dev (>= 1.24.5-4),
 pkgconfig (>= 0.21-1),
 setuptools-tng-py%type_pkg[python],
 tcltk-dev,
 tornado-py%type_pkg[python],
 wxpython400-py%type_pkg[python] | wxpython410-py%type_pkg[python],
 x11-dev
<<

Recommends: <<
 ffmpeg,
 imagemagick,
 ipython-py%type_pkg[python]
<<

BuildConflicts: libharfbuzz0-dev, qhull5-dev, qhull6-dev, qhull6.3.1-dev

GCC: 4.0

NoSetCPPFLAGS: True
SetCPPFLAGS: -I%p/include/pygtk-2.0 -DNSIG=32 -MD
SetCXXFLAGS: -MD
SetLDFLAGS: -L%p/lib -lz -lbz2 -lpng16
UseMaxBuildJobs: True

PatchFile: %{ni}.patch
PatchFile-MD5: 98e8db5dd66b9f68f9ad19e7fb5a01ee
PatchScript: sed 's|@PREFIX@|%p|g;s|@PY_PKG@|%type_pkg[python]|g;s|@PY_RAW@|%type_raw[python]|g' < %{PatchFile} | patch -p1

CompileScript:  <<
 #!/bin/sh -ev
 cp -a setup.cfg{.template,}
 # Build against a local copy of freetype-2.6.1 to ensure exact version match
 mkdir build
 mv ../freetype-2.6.1 build
 export MPLLOCALFREETYPE="$MFLAGS"
 export PKG_CONFIG_PATH="%p/lib/glib-2.0/pkgconfig-strict:$PKG_CONFIG_PATH"
 OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES %p/bin/python%type_raw[python] setup.py build
 fink-package-precedence --depfile-ext='\.d' build
<<

InfoTest: <<
 TestDepends: <<
  ffmpeg,
  inkscape,
  numpy-py%type_pkg[python] (>= 1.18.1-1),
  pyparsing-py%type_pkg[python] (>= 2.4.5-1),
  pytest-py%type_pkg[python] (>= 3.6.0)
 <<
 # test_backends_nbagg checks for nbconvert but fails with older versions.
 TestConflicts: nbconvert-py%type_pkg[python] (<= 6.0.0-1)
 TestScript: <<
  #!/bin/sh -ev
  export LANG=en_US.UTF-8
  export PYTHONPATH=%b/build/lib/python%type_raw[python]/site-packages
  mkdir -p $PYTHONPATH
  OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES %p/bin/python%type_raw[python] setup.py develop --no-deps --prefix %b/build
  # Comparison images are expected in `Path(__file__).parent / "baseline_images"`
  # - mpl_toolkits still may not find them if matplotlib is already installed in system path.
  ln -s ../../../../lib/matplotlib/tests/baseline_images build/lib.macosx*-%type_raw[python]/matplotlib/tests
  ln -s ../../../../lib/mpl_toolkits/tests/baseline_images build/lib.macosx*-%type_raw[python]/mpl_toolkits/tests
  PYTHONPATH="${PYTHONPATH}:$(ls -d %b/build/lib.macosx*-%type_raw[python])"
  %p/bin/python%type_raw[python] -Bm pytest lib/mpl_toolkits || echo 'mpl_toolkits tests not working with installed matplotlib'
  %p/bin/python%type_raw[python] -Bm pytest -k 'not (_pdflatex or _rcupdate or _marker_clipping or _interactive_backend or (_mixedmode and pdf))' lib/matplotlib || exit 2
  rm build/lib.macosx*-%type_raw[python]/m*/tests/baseline_images
  find build/lib.macosx*-%type_raw[python] -name '*.pyc' -delete
 <<
 TestSuiteSize: large
<<

InstallScript: <<
 #!/bin/sh -ev
 export PKG_CONFIG_PATH="%p/lib/glib-2.0/pkgconfig-strict:$PKG_CONFIG_PATH"
 OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES %p/bin/python%type_raw[python] setup.py install --root %d
 export LANG=en_US.UTF-8 PYTHONPATH=%i/lib/python%type_raw[python]/site-packages
<<

License: OSI-Approved
DocFiles: README.rst INSTALL.rst PKG-INFO LICENSE examples tutorials
# API_CHANGES
Description: Pure python 2D plotting with a Matlab syntax
DescDetail: <<
Produces publication quality figures using in a variety of hardcopy 
formats (PNG, JPG, TIFF, PS) and interactive GUI environments
across platforms. matplotlib can be used in python scripts,
interactively from the python shell (a la matlab or mathematica), 
in web application servers generating dynamic charts, or embedded 
in applications.

Includes Qt4[Agg], Qt5[Agg], Tk[Agg], WX[Agg], PDF, PS, SVG and Agg backends.
<<
DescPackaging: <<
 Check only for backends actually provided through Depends and require them.
 Added dependencies on six-py, and poppler-bin for pdftops.
 Recommended optional dependencies:
  ImageMagick: for animation module to be able to save to animated gif
  ffmpeg: for animation module to be able to save to movie formats
  pil-py: read and write a larger selection of image file formats

 qhull not recognised by pkg-config; as of 2.1 requires version 2015.2 / 7.2,
 but mpl does not link against the reentrant version (libqhull_r.dylib) -
 falling back to the local copy until mpl is converted to libqhull_r or we
 find a way to install the non-reentrant dylib with libqhull-shlibs as well.
 (cf. http://www.qhull.org/html/qh-code.htm#reentrant .)
 Qt4 backend to be phased out and already unsupported with ipython --pylab.
 Enabled build against wxpython400, requires patch to ipython-py 7.5.0 for
 pylab environment; RuntimeError in backends/backend_wx.py on exit.
 [ Added patch from https://github.com/matplotlib/matplotlib/pull/14292 - merged in 3.1.1]
 Fix performance regression when plotting values from Numpy array sub-classes.

 Multiprocessing in setupext BackendQtBase.check_requirements tends to hang
 in the build sandbox - trying a second pass after timeout, but on 10.13 fork()
 inevitably fails, apparently related to this thread safety issue:
 https://blog.phusion.nl/2017/10/13/why-ruby-app-servers-break-on-macos-high-sierra-and-what-can-be-done-about-it/
 - workaround taken from the same site.
 Test suite requires exact version match of freetype built against (2.6.1),
 set by local_freetype=True in setup.cfg, to ensure correct image comparison.
 Always used in build against local source copy - this will create and link
 against a packaged ft2font.cpython-*-darwin.so.
 Patched tests to make them use matching versions of [i]python and jupyter.
 Changed 'reruns' kwarg to 'max_runs' to keep flaky 3.x happy.
<<
Homepage: http://matplotlib.sf.net
DescUsage: <<
 To use within IPython, invoke as `ipython --matplotlib[=backend]` or
 `ipython --pylab[=backend]`, where backend is one of
 ['auto', 'inline', 'nbagg', 'qt', 'qt4', 'qt5', 'tk', 'wx']
 (gtk3 fails due to missing pycairo >= 1.11 on Python 3).
<<
# Info2
<<
